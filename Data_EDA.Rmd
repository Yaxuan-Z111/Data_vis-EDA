---
title: "data_EDA"
author: "yz5248"
date: "2025-10-02"
output: github_document
---
```{r}
library(p8105.datasets)
library(tidyverse)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

```{r}
data("weather_df")

weather_df = 
  weather_df |>
  mutate(month = floor_date(date, unit = "month"))
```

make plots

```{r}
weather_df |> 
  ggplot(aes(x = prcp)) + 
  geom_histogram()
```


check on extreme values
```{r}
weather_df |> 
  filter(prcp > 1000)
```

look at data again
```{r}
weather_df |> 
  filter(tmax >= 20, tmax <= 30) |> 
  ggplot(aes(x = tmin, y = tmax, color = name, shape = name)) + 
  geom_point()
```

```{r}
weather_df |>
  group_by(name, month)
```

```{r}
weather_df |>
  group_by(name) |>
  summarize(
    n = n()
    )
```

```{r}
weather_df |>
  group_by(name, month) |>
  summarize(
    n = n()
  )
```

```{r}
weather_df |>
  group_by(month) |>
  summarize(
    n_obs = n(),
    n_days = n_distinct(date))
```

```{r}
weather_df |>
  count(name)
```

```{r}
weather_df |>
  group_by(month) |>
  summarize(
    mean_tmax = mean(tmax, na.rm = TRUE),
    median_tmin = median(tmin, na.rm = TRUE),
    sd_prcp = sd(prcp, na.rm = TRUE)
  ) |> view()
```

```{r}
weather_df |>
  group_by(name, month) |>
  summarise(
    mean_tmax = mean(tmax, na.rm = TRUE)
  ) |>
  ggplot(aes(x = month, y = mean_tmax, colour = name)) +
  geom_point() +
  geom_line()
```

```{r}
weather_df |>
  group_by(name, month) |>
  summarise(
    mean_tmax = mean(tmax, na.rm = TRUE)
  ) |>
  pivot_wider(
    names_from = name,
    values_from = mean_tmax
  ) |>
  knitr::kable(digits = 2)
```

##mutate with groups
```{r}
weather_df |>
  group_by(name) |>
  mutate(
    mean_tmax = mean(tmax, na.rm = TRUE),
    centered_tmax = tmax - mean_tmax) |> 
  ggplot(aes(x = date, y = centered_tmax, color = name)) + 
    geom_point() 
```

```{r}
weather_df |>
  group_by(name, month) |>
  mutate(temp_rank = min_rank(tmax)) |>
  filter(temp_rank < 2)
```

```{r}
weather_df |>
  group_by(name, month) |>
  mutate(temp_rank = min_rank(desc(tmin))) |>
  view()
```

what about lags?
```{r}
weather_df |>
  group_by(name) |>
  mutate(lagged_tmax = lag(tmax))
```

```{r}
weather_df |>
  group_by(name) |>
  mutate(temp_change = tmax - lag(tmax)) |>
  summarize(
    temp_change_sd = sd(temp_change, na.rm = TRUE),
    temp_change_max = max(temp_change, na.rm = TRUE))
```

```{r}
weather_df |>
  group_by(name) |>
  mutate(
    temp_change = tmax - lag(tmax)
    )|>
  filter(
     min_rank(desc(temp_change))<2
  )
```


###case study
```{r}
library(p8105.datasets)
library(tidyverse)
library(leaflet)
library(tibble)
data(nyc_airbnb) 
```
#brainstorm
- Pick a neighborhood / borough, investigate price
- If we have dates, does it affect price
- what about zip
- what rental has the highest reviews
- are there any connection between price and other variables
- what about prices over time
- could we look at prices before and after pandemic
- how else did the pademic after AirBNB in NYC
- does the name of the rental affectnthe price/rental
- what does the number of days available have to do with anything else


let's look at the price first
```{r}
nyc_airbnb |>
  drop_na(price) |>
  filter(neighbourhood_group == "Manhattan") |>
  group_by(neighbourhood_group) |>
  summarise(
    mean_price = mean(price),
    min_price = min(price),
    max_price = max(price)
      
  )
```

```{r}
nyc_airbnb |>
  drop_na(price) |>
  group_by(room_type, neighbourhood_group) |>
  summarise(
    mean_price = mean(price)
      
  ) |>
  pivot_wider(
    names_from = room_type,
    values_from = mean_price
  )
```

```{r}
nyc_airbnb |>
  count(neighbourhood_group,room_type)
```

make some plot
```{r}
nyc_airbnb |>
  ggplot(aes(x = price)) +
  geom_histogram() +
  facet_grid(room_type ~ neighbourhood_group) +
  scale_x_continuous(limits = c(0,1000))
```

```{r}
nyc_airbnb |>
  filter(neighbourhood_group == "Manhattan",
         price < 500,
         room_type == "Entire home/apt") |>
  mutate(
    neighbourhood = fct_reorder(neighbourhood, price)
  ) |>
  ggplot(aes(x = neighbourhood_group, y = price)) +
  geom_violin() +
  theme(axis.text = element_text(angle = 90, hjust = 1, vjust = 0.5))
```

look at extreme value
```{r}
nyc_airbnb |> filter(price > 9000)
```

```{r}
nyc_airbnb |> filter(calculated_host_listings_count > 30)
```

```{r}
nyc_airbnb |>
  filter(neighbourhood_group == "Manhattan",
         price < 500,
         room_type == "Entire home/apt") |>
  mutate(
    neighbourhood = fct_reorder(neighbourhood, price)
  ) |>
  ggplot(aes(x = lat, y = long, color = review_scores_location)) +
  geom_point()
```

make a better map
```{r}
nyc_airbnb |>
  filter(
    neighbourhood_group == "Manhattan",
         price < 500,
         room_type == "Entire home/apt"
  ) |>
  leaflet() |>
  addTiles()|>
  addMarkers(~lat, ~long)
  
```

```{r}
pal <- colorNumeric(
  palette = "viridis",
  domain = nyc_airbnb$review_scores_location
)
nyc_airbnb |>
  filter(
    neighbourhood_group == "Manhattan",
         price < 500,
         room_type == "Entire home/apt"
  ) |>
  leaflet() |>
  addProviderTiles(providers$CartoDB.Positron)|>
  addCircleMarkers(
    ~lat, ~long,
    color = ~pal(price),
    radius = 2
  )
```


